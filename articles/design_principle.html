<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Package Design vignette for {readepi} • readepi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Package Design vignette for {readepi}">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">readepi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/readepi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/design_principle.html">Package Design vignette for {readepi}</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/readepi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="design_principle_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="design_principle_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="design_principle_files/viz-1.8.2/viz.js"></script><link href="design_principle_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="design_principle_files/grViz-binding-1.0.11/grViz.js"></script><script src="design_principle_files/d3-3.3.8/d3.min.js"></script><script src="design_principle_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="design_principle_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="design_principle_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><script src="design_principle_files/chromatography-0.1/chromatography.js"></script><script src="design_principle_files/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Package Design vignette for {readepi}</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/readepi/blob/main/vignettes/design_principle.Rmd" class="external-link"><code>vignettes/design_principle.Rmd</code></a></small>
      <div class="d-none name"><code>design_principle.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.section {
  opacity: 1;
}
</style>
<div class="section level2">
<h2 id="concept-and-motivation">Concept and motivation<a class="anchor" aria-label="anchor" href="#concept-and-motivation"></a>
</h2>
<p>This document outlines the design decisions that is guiding the
development strategies of the {readepi} R package, the reasoning behind
them, as well as the possible pros and cons of each decision.</p>
<p>Importing data from “whatever source of it” into <code>R</code>
environment is the first step in many workflows of outbreak analysis.
Epidemiological data are often stored in files of different formats. The
most popular among those formats being: ‘.txt’, ‘.tab’, ‘.csv’, ‘.xlxs’,
etc.</p>
<p>Many R packages have been developed over the years to facilitate the
importation of data stored in such files. We recommend the <a href="http://gesistsa.github.io/rio/" class="external-link">{rio}</a> package for importing
data that are relatively of small size and the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/" class="external-link">{data.table}</a>
package for large files.</p>
<p>To enable easy and real time access of well structured data, most
organisations in the world are now storing their data in public
repositories, relational database management systems (RDBMS), and health
information systems (HIS) wrapped with specific Application Programming
Interfaces (APIs). As such, we aim at building a centralized tool that
will provide users with the possibility of importing data from various
HIS and RDBMS.</p>
<p>Our first attempt consisted in using the currently available R
packages designed to access data from specific HIS. These packages are
usually tied to a single HIS and can’t be used to query others.
{fingertipsR}, {REDCapR}, {godataR}, {globaldothealth} can be used to
fetch data from <a href="https://fingertips.phe.org.uk/" class="external-link">Fingertips</a>,
<a href="https://projectredcap.org/software/" class="external-link">REDCap</a>, <a href="https://www.who.int/tools/godata" class="external-link">goData</a>, and <a href="https://global.health/" class="external-link">Global.Health</a> respectively. In version
<strong>0.1.0</strong> of the {readepi} package, when a user is
requesting data from a specific HIS, its correspondent package is called
internally.</p>
<p>As each package was designed to target a specific HIS, this approach
increases our dependency to many other packages and introduces the
challenge of having a unified framework for importing data from multiple
HIS.</p>
<p>To address this challenge, PIs of the <a href="https://data.org/initiatives/epiverse/" class="external-link">Epiverse-TRACE</a> came
with a list of potential data sources for which we aim at building a
tool to request and fetch the data of interest from multiple source in
the same way. The data sources include: distributed health information
systems, and public databases as shown in the figure below.</p>
<div class="float">
<img src="../reference/figures/roadmap_readepi.drawio.svg" alt="readepi roadmap"><div class="figcaption">readepi roadmap</div>
</div>
</div>
<div class="section level2">
<h2 id="scope">Scope<a class="anchor" aria-label="anchor" href="#scope"></a>
</h2>
<p>The {readepi} package intends to import data from two common sources
of institutional health-related data: health information systems (HIS)
wrapped with specific Application programming interfaces (APIs) and
relational database management systems (RDBMS) that run on specific
servers.</p>
<p>Importing data from any of these sources requires the user to have
the right access. The user is also expected to provide the relevant
query parameters to fetch the target data. Hence, the {readepi} package
is structured around one main function (<code>read_epidata()</code>) and
two auxiliary functions (<code>authenticate()</code> and
<code>get_metadata()</code>).</p>
<p>The previous version of {readepi} (<code>0.1.0</code>) supports
importing data from HIS APIs such as REDCap (Research Electronic Data
Capture), DHIS2 (District Health Information System 2), and Fingertips
as well as RDBMS such as MS SQL, SQLite, MYSQL, and PostgreSQL.</p>
<p>In the next versions, the <code>read_epidata()</code> function will
also allow data import from HIS like GoData, Globaldothealth, SORMAS,
and ODK. It will also include functionalities for importing data from
RDBMS such as MS ACCESS, and SQlite.</p>
<div class="float">
<img src="../reference/figures/readepi_design_diagram.drawio.svg" alt="readepi design diagram"><div class="figcaption">readepi design diagram</div>
</div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>The <code>read_epidata()</code> functions return a <code>list</code>
object containing one or more <code>data frames</code>. Each
<code>data frame</code> corresponds to the data from a specified source.
The <code>get_metadata()</code> function returns a data dictionary
containing information about the data structure. The
<code>authenticate()</code> function returns a connection object that is
used in the query request.</p>
</div>
<div class="section level2">
<h2 id="design-decisions">Design decisions<a class="anchor" aria-label="anchor" href="#design-decisions"></a>
</h2>
<p>The aim of {readepi} is to simplify and standardize the process of
fetching health data from APIs and servers. We ambition to make it
require minimal arguments to access and pull the data of interest from
the target source.</p>
<ul>
<li>
<code>authenticate()</code>: a function used to authenticate a user
(check who the user is) and check whether the user is authorized to
access the requested database or API. This function is fundamental to
establish the connection to the source, ensuring the success of data
import.</li>
</ul>
<p>We will ensure that once an argument is provided for the
authentication, it is easily retrieved from the connection object, and
used in the 2 other functions, hence preventing from been supplied again
in another request.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:768px;height:474.660074165637px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph{\n \n      graph[rankdir = LR]\n  \n      node[shape = rectangle, style = filled, fontname = Courier,\n      align = center]\n  \n      subgraph cluster_0 {\n        graph[shape = rectangle]\n        style = rounded\n        bgcolor = LightBlue\n    \n        label = \"authenticate()\"\n        node[shape = rectangle, fillcolor = LemonChiffon, margin = 0.25]\n        A[label = \"type: the source name\"]\n        B[label = \"from: the URL, or IP address, or hostname\"]\n        C[label = \"user_name: the user name\"]\n        D[label = \"password: the password or API token or key\"]\n        E[label = \"db_name: the database name (RDBMS only)\"]\n        F[label = \"port: the port id (RDBMS only)\"]\n        G[label = \"driver_name: the driver name (RDBMS only)\"]\n      }\n      \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The <code>type</code> argument refers to the name of the data source
of interest. The current version of the package will cover the
followings:</p>
<pre><code>i) RDBMS: “MS SQL”, “MySQL”, “PostgreSQL”, “SQLite”, “MS ACCESS”,
ii) APIs: “REDCap”, “DHIS2”, “ODK”, “Fingertips”, “goData”, “SORMAS”</code></pre>
<ul>
<li>
<code>get_metadata()</code>: will be used to retrieve the data
schema (table list + data dictionary) from a database or the data
dictionary from an endpoint of the target API. It offers
interoperability with the <code>clean_based_on_dictionay()</code>
function of the <a href="https://epiverse-trace.github.io/cleanepi/" class="external-link">{cleanepi}</a> R
package.</li>
</ul>
<div class="grViz html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:768px;height:474.660074165637px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"digraph{\n \n      graph[rankdir = LR]\n  \n      node[shape = rectangle, style = filled, fontname = Courier,\n      align = center]\n  \n      subgraph cluster_0 {\n        graph[shape = rectangle]\n        style = rounded\n        bgcolor = LightBlue\n    \n        label = \"get_metadata()\"\n        node[shape = rectangle, fillcolor = LemonChiffon, margin = 0.25]\n        A[label = \"conn: the connection object made from authenticate()\"]\n        B[label = \"endpoint: the path to the target endpoint (APIs only)\"]\n        C[label = \"query: a list with the query parameters\"]\n      }\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><ul>
<li>
<code>read_epidata()</code>: this is the main function of the
package. It can be used to read from both HIS and RDBMS.</li>
</ul>
<div class="grViz html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:768px;height:474.660074165637px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"digraph{\n \n      graph[rankdir = LR]\n  \n      node[shape = rectangle, style = filled, fontname = Courier,\n      align = center]\n  \n      subgraph cluster_0 {\n        graph[shape = rectangle]\n        style = rounded\n        bgcolor = LightBlue\n    \n        label = \"read()\"\n        node[shape = rectangle, fillcolor = LemonChiffon, margin = 0.25]\n        A[label = \"conn: the connection object made from authenticate()\"]\n        B[label = \"endpoint: the path to the target endpoint (APIs only)\"]\n        C[label = \"query: a list with the query parameters\"]\n      }\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>An internal function (<code>read_*</code> where <code>*</code> is the
source name) is designed for fetching data from a specific HIS. This
implementation will make it possible to perform updates on a specific
function, while conserving the remaining structures (easy
maintenance).</p>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:768px;height:474.660074165637px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"\ngraph TB\n    A[read_epidata]\n    A --> B(read_rdbms)\n    A --> D(read_redcap)\n    A --> E(read_dhis2)\n    A --> F(read_fingertips)\n    A --> G(read_sormas)\n    A --> H(read_ODK)\n    A --> I(read_godata)\n"},"evals":[],"jsHooks":[]}</script><p>Note that, when reading from RDBMS, the <code>query</code> argument
could be an <u>SQL query</u> or a <u>list with a vector of table names,
fields and rows to subset on</u>. For HIS, the elements of this list can
vary depending on the API that is been queried. We strongly recommend
reading the vignette on the <a href="./query_parameters.Rmd">query_parameters</a> for more details.</p>
</div>
<div class="section level2">
<h2 id="mitigate-api-security-risks">Mitigate API security risks<a class="anchor" aria-label="anchor" href="#mitigate-api-security-risks"></a>
</h2>
<p>To prevent from APIs security risks and issues, we will ensure that
our API requests follow the practices listed below:</p>
<ol style="list-style-type: decimal">
<li>Identify API gateway (centralized point of entry) and send
authentication requests to this gateway</li>
<li>Make sure users access only the data they are allowed to:
<ul>
<li>use OAuth or token-based authentication if possible</li>
<li>determine the data a user can have access to. Send a meaningful
error message when a user attempts to access unauthorized data.</li>
</ul>
</li>
<li>Make sure API key is not sent as part of the URL to avoid it been
copied from the proxy logs or other places</li>
<li>Control the number of requests that can be sent in a time period,
and the number of pages that to be returned in the API response.</li>
<li>Prevent from sending/receiving malicious data:
<ul>
<li>use parameterized query</li>
<li>validate and sanitize inputs</li>
</ul>
</li>
<li>Continuously maintain our hard-coded resources:
<ul>
<li>regularly review and decommission unused APIs</li>
<li>maintain and update list of all endpoints</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h2>
<ul>
<li>
<p>The <code>read_epidata()</code> will rely mainly on 2
packages:</p>
<p><a href="https://CRAN.R-project.org/package=httr2" class="external-link">{httr2}</a> or <a href="https://CRAN.R-project.org/package=data.table" class="external-link">{data.table}</a>:
this will serve in constructing and performing the API requests, <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">{dplyr}</a>: will be
used for its data wrangling functionalities.</p>
</li>
<li>
<p>The <code>read_from_server()</code> will rely mainly on the
packages below:</p>
<p><a href="https://CRAN.R-project.org/package=DBI" class="external-link">{DBI}</a>: for its
functionalities to connect, and fetch data from a table in a database,
<a href="https://CRAN.R-project.org/package=pool" class="external-link">{pool}</a>: for its
ability to handle multiple connection, <a href="https://CRAN.R-project.org/package=odbc" class="external-link">{odbc}</a>: for its
drivers required to fetch data from several DBMS, <a href="https://CRAN.R-project.org/package=RMySQL" class="external-link">{RMySQL}</a>: for its
drivers to fetch data from MySQL databases.</p>
</li>
</ul>
<p>It also has a system dependency for OS-X and Linux users. This will
be described in details in the vignette.</p>
<p>Both functions will require all other packages that are needed in the
package development process including:</p>
<p><a href="https://CRAN.R-project.org/package=checkmate" class="external-link">{checkmate}</a>, <a href="https://CRAN.R-project.org/package=httptest2" class="external-link">{httptest2}</a>, <a href="https://CRAN.R-project.org/package=bookdown" class="external-link">{bookdown}</a>, <a href="https://CRAN.R-project.org/package=rmarkdown" class="external-link">{rmarkdown}</a>, <a href="https://CRAN.R-project.org/package=testthat" class="external-link">{testthat}</a> (&gt;=
3.0.0), <a href="https://CRAN.R-project.org/package=knitr" class="external-link">{knitr}</a></p>
</div>
<div class="section level2">
<h2 id="contribute">Contribute<a class="anchor" aria-label="anchor" href="#contribute"></a>
</h2>
<p>There are no special requirements to contributing to {readepi},
please follow the <a href="https://github.com/epiverse-trace/.github/blob/main/CONTRIBUTING.md" class="external-link">package
contributing guide</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Karim Mané, data.org.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3. Theme provided by <a href="https://github.com/epiverse-trace/epiversetheme" class="external-link">epiversetheme</a> 0.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
